<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Panel de Revisi√≥n - Observatorio Walmart M√©xico</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <header>
      <h1>Panel de Revisi√≥n Interno</h1>
      <nav>
        <a href="index.html">Inicio</a>
        <a href="formulario.html">Registrar denuncia</a>
        <a href="denuncias.html">Casos publicados</a>
      </nav>
    </header>

    <main>
      <section id="pendientes">
        <h2>Denuncias pendientes de revisi√≥n</h2>
        <!-- Aqu√≠ se insertar√°n din√°micamente las denuncias -->
      </section>

      <section id="estadisticas">
        <h2>Estad√≠sticas internas</h2>
        <ul id="stats"></ul>
      </section>
    </main>

    <footer>
      <p>&copy; 2026 Observatorio de Denuncias Walmart M√©xico</p>
    </footer>

    <!-- üëá Script al final del body -->
    <script>
      async function cargarPendientes() {
        const respuesta = await fetch("http://localhost:3000/denuncias");
        const denuncias = await respuesta.json();
        const contenedor = document.getElementById("pendientes");

        let total = denuncias.length;
        let pendientes = 0,
          aprobadas = 0,
          rechazadas = 0;

        denuncias.forEach((d) => {
          if (d.estatus === "Pendiente") {
            pendientes++;
            const card = document.createElement("div");
            card.className = "denuncia-card";
            card.innerHTML = `
              <h3>${d.titulo}</h3>
              <p><strong>Producto:</strong> ${d.producto}</p>
              <p><strong>Descripci√≥n:</strong> ${d.descripcion}</p>
              <p><strong>Estatus:</strong> ${d.estatus}</p>
              <button onclick="cambiarEstatus('${d.id}','Aprobada')">‚úÖ Aprobar</button>
              <button onclick="cambiarEstatus('${d.id}','Rechazada')">‚ùå Rechazar</button>
              <button onclick="cambiarEstatus('${d.id}','Solicitar m√°s informaci√≥n')">üì© Solicitar m√°s informaci√≥n</button>
            `;
            contenedor.appendChild(card);
          } else if (d.estatus === "Aprobada") {
            aprobadas++;
          } else if (d.estatus === "Rechazada") {
            rechazadas++;
          }
        });

        // Actualizar estad√≠sticas
        document.getElementById("stats").innerHTML = `
          <li>Total de denuncias recibidas: ${total}</li>
          <li>Pendientes de revisi√≥n: ${pendientes}</li>
          <li>Aprobadas: ${aprobadas}</li>
          <li>Rechazadas: ${rechazadas}</li>
        `;
      }

      async function cambiarEstatus(id, nuevoEstatus) {
        await fetch(`http://localhost:3000/denuncias/${id}/estatus`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ estatus: nuevoEstatus }),
        });
        alert(`Denuncia ${id} actualizada a: ${nuevoEstatus}`);
        location.reload();
      }

      window.onload = cargarPendientes;
    </script>
  </body>
</html>
