<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Panel de administración</title>
  </head>
  <body>
    <h1>Panel de administración</h1>
    <table border="1">
      <thead>
        <tr>
          <th>ID</th>
          <th>Título</th>
          <th>Producto</th>
          <th>Clasificación</th>
          <th>Estatus</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla-admin"></tbody>
    </table>

    <script>
      async function cargarDenuncias() {
        const res = await fetch("/denuncias");
        const denuncias = await res.json();

        const tbody = document.getElementById("tabla-admin");
        tbody.innerHTML = "";

        denuncias.forEach((d) => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
          <td>${d.id}</td>
          <td>${d.titulo}</td>
          <td>${d.producto}</td>
          <td>${d.clasificacion}</td>
          <td>${d.estatus}</td>
          <td>
            <button onclick="cambiarEstatus('${d.id}', 'Resuelta')">Marcar como Resuelta</button>
            <button onclick="cambiarEstatus('${d.id}', 'Pendiente')">Marcar como Pendiente</button>
          </td>
        `;
          tbody.appendChild(fila);
        });
      }

      async function cambiarEstatus(id, nuevoEstatus) {
        // Obtener todas las denuncias
        const res = await fetch("/denuncias");
        const denuncias = await res.json();

        // Buscar la denuncia por ID
        const denuncia = denuncias.find((d) => d.id === id);
        if (!denuncia) return;

        // Actualizar el estatus en memoria
        denuncia.estatus = nuevoEstatus;

        // Enviar actualización al backend (simulación: POST de reemplazo)
        await fetch("/denuncias", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(denuncia),
        });

        // Recargar tabla
        cargarDenuncias();
      }

      cargarDenuncias();
    </script>
  </body>
</html>
